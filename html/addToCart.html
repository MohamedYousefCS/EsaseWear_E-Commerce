<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1 id="h1"></h1>
    <h1 id="h2"></h1>
    <h1 id="h3"></h1>
    <img src="" id="img" width="100px">
    <script>
        window.addEventListener("load", function () {
            var params = new URLSearchParams(window.location.search);
            let numOfItems = params.get('numOfItems');
            let sizeOfProduct = params.get('sizeOfProduct');
            //number of products
            document.getElementById("h1").innerText = numOfItems;
            //size of product
            document.getElementById("h2").innerText = sizeOfProduct;
            //user id
            let currentUserId = JSON.parse(localStorage.getItem("user"))['id'];
            //product id
            let productId=params.get('productId');
            document.getElementById('h3').innerText=productId;
            //productImg
            document.getElementById('img').src = JSON.parse(localStorage.getItem("products"))[productId][
                'product_img'
            ];
        });
    </script>











<script>
    document.addEventListener("DOMContentLoaded", function () {
        let currentUserId = JSON.parse(localStorage.getItem("user"))?.id;

        // Check if the user is logged in
        if (currentUserId) {
            // Retrieve cartData for the logged-in user from local storage
            let cartData = JSON.parse(localStorage.getItem("cartData")) || [];
            let userCart = cartData.filter(item => item.userId === currentUserId);

            // Reference to the tbody element
            let cartBody = document.getElementById("cartBody");

            if (userCart.length > 0) {
                // Retrieve products data from local storage
                let productsData = JSON.parse(localStorage.getItem("products")) || {};

                // Iterate over each item in the user's cart and create a table row dynamically
                userCart.forEach(function (cartItem) {
                    // Retrieve product details from productsData using productId
                    let productId = cartItem.productId;
                    let productDetails = productsData[productId] || {};

                    // Calculate total price
                    let totalPrice = parseFloat(productDetails.price) * parseInt(cartItem.numOfItems);

                    // Create a new table row
                    let newRow = document.createElement("tr");
                    newRow.innerHTML = `
                    <td><a href="#" class="remove-item"><i class="fas fa-trash-alt"></i></a></td>
                    <td><img src="${productDetails.product_img}" alt="Cart Img"></td>
                    <td><h5>${productDetails.product_name}</h5></td>
                    <td><h5>${productDetails.price}</h5></td>
                    <td><input class="w-50 pl-1" type="number" value="${cartItem.numOfItems}" min="1" max="5" data-product-id="${productId}"></td>
                    <td><h5 class="totalPrice">$${totalPrice.toFixed(2)}</h5></td>
                `;

                    // Append the new row to the tbody
                    cartBody.appendChild(newRow);

                    // Add event listener to update total price on quantity change
                    let quantityInput = newRow.querySelector('input');
                    quantityInput.addEventListener('change', function () {
                        // Update the quantity in the cartData
                        cartItem.numOfItems = parseInt(this.value);

                        // Update total price
                        totalPrice = parseFloat(productDetails.price) * parseInt(cartItem.numOfItems);
                        newRow.querySelector('.totalPrice').innerText = "$" + totalPrice.toFixed(2);

                        // Update cartData in local storage
                        localStorage.setItem("cartData", JSON.stringify(cartData));
                    });

                    // Add event listener to remove item on trash icon click
                    let removeIcon = newRow.querySelector('.remove-item');
                    removeIcon.addEventListener('click', function (event) {
                        event.preventDefault();

                        // Remove the row from the table

                        const Toast = Swal.mixin({
                            toast: true,
                            position: "top-end",
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.onmouseenter = Swal.stopTimer;
                                toast.onmouseleave = Swal.resumeTimer;
                            }
                        })
                        Swal.fire({
                            title: "Are you sure?",
                            text: "Do you want to delete this item from your cart?",
                            icon: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#3085d6",
                            cancelButtonColor: "#d33",
                            confirmButtonText: "Yes, delete it!"
                        }).then((result) => {
                            if (result.isConfirmed) {
                                newRow.remove();
                                Toast.fire({
                                    icon: "Deleted",
                                    title: "the item has been deleted.",
                                    icon: "success"
                                });
                            }
                        });
                        // Remove the item from cartData
                        cartData = cartData.filter(item => item.productId !== productId);

                        // Update cartData in local storage
                        localStorage.setItem("cartData", JSON.stringify(cartData));
                    });
                });
            } else {
                // Display a message when the user's cart is empty
                cartBody.innerHTML = `<tr><td colspan="6">Your cart is empty</td></tr>`;
            }
        } else {
            // Display a message when the user is not logged in
            document.getElementById("cartBody").innerHTML = `<tr><td colspan="6">Please log in to view your cart</td></tr>`;
        }
    });
</script>
<!-- script for cart end -->

<!-- script for total -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let currentUserId = JSON.parse(localStorage.getItem("user"))?.id;

        // Check if the user is logged in
        if (currentUserId) {
            // Retrieve cartData for the logged-in user from local storage
            let cartData = JSON.parse(localStorage.getItem("cartData")) || [];
            let userCart = cartData.filter(item => item.userId === currentUserId);

            // Reference to the elements
            let appliedCouponDiv = document.getElementById("appliedCoupon");
            let subtotalElement = document.getElementById("subtotal");
            let shippingElement = document.getElementById("shipping");
            let totalElement = document.getElementById("total");
            let applyCouponBtn = document.getElementById("applyCouponBtn");
            let couponCodeInput = document.getElementById("couponCode");

            if (userCart.length > 0) {
                // Retrieve products data from local storage
                let productsData = JSON.parse(localStorage.getItem("products")) || {};

                // Function to calculate subtotal and update UI
                function calculateSubtotal() {
                    let subtotal = 0;
                    userCart.forEach(function (cartItem) {
                        let productId = cartItem.productId;
                        let productDetails = productsData[productId] || {};
                        subtotal += parseFloat(productDetails.price) * parseInt(cartItem.numOfItems);
                    });

                    subtotalElement.innerText = `$${subtotal.toFixed(2)}`;
                    return subtotal;
                }

                // Calculate and display initial subtotal
                let initialSubtotal = calculateSubtotal();
                subtotalElement.innerText = `$${initialSubtotal.toFixed(2)}`;

                // Add event listener to update subtotal on quantity change
                document.addEventListener('change', function (event) {
                    if (event.target && event.target.tagName === 'INPUT' && event.target.dataset.productId) {
                        initialSubtotal = calculateSubtotal();
                        subtotalElement.innerText = `$${initialSubtotal.toFixed(2)}`;
                        updateTotal();
                    }
                });

                // Calculate and display initial total
                updateTotal();

                // Add event listener to apply coupon
                applyCouponBtn.addEventListener('click', function () {
                    let couponCode = couponCodeInput.value;

                    // Check if the coupon code is valid
                    let validCoupons = JSON.parse(localStorage.getItem("coupons")) || [];
                    let appliedCoupon = validCoupons.find(coupon => coupon.code === couponCode);

                    if (appliedCoupon) {
                        // Update UI to display the applied coupon
                        appliedCouponDiv.innerHTML = `<p>Applied Coupon: ${appliedCoupon.percentage}% off</p>`;

                        // Calculate the discounted total
                        let discount = (appliedCoupon.percentage / 100) * initialSubtotal;
                        let discountedTotal = initialSubtotal + parseFloat(shippingElement.innerText) - discount;

                        totalElement.innerText = `$${discountedTotal.toFixed(2)}`;
                    } else {
                        // Display an error message for an invalid coupon
                        appliedCouponDiv.innerHTML = `<p style="color: red;">Invalid Coupon</p>`;
                    }
                });
            } else {
                // Display a message when the user's cart is empty
                appliedCouponDiv.innerHTML = `<p>Your cart is empty</p>`;
            }
        } else {
            // Display a message when the user is not logged in
            document.getElementById("appliedCoupon").innerHTML = `<p>Please log in to view your cart</p>`;
        }

        // Function to update the total
        function updateTotal() {
            let subtotal = parseFloat(subtotalElement.innerText.replace('$', ''));
            let shipping = parseFloat(shippingElement.innerText.replace('$', ''));
            let total = subtotal + shipping;
            totalElement.innerText = `$${total.toFixed(2)}`;
        }
    });
</script>
</body>




</html>